# Passo a Passo para Deploy no Azure

Cole cada comando individualmente no terminal da Azure CLI.  
Cada bloco abaixo mostra o comando e um comentário explicando sua função.

---

# 1. Clonar o repositório do projeto
git clone https://github.com/igorbarrocal/MotoFacil.API-devops.git
cd MotoFacil.API-devops

---

# 2. Criar o grupo de recursos (Resource Group)
az group create --name motofacil-rg --location brazilSouth
# (Cria um agrupador lógico para os recursos do Azure)

---

# 3. Criar o servidor SQL Azure
az sql server create --name motofacilserver --resource-group motofacil-rg --location brazilSouth --admin-user motofaciladmin --admin-password "Motofacil#2025"
# (Provisiona um servidor SQL na Azure)

---

# 4. Criar o banco de dados SQL
az sql db create --resource-group motofacil-rg --server motofacilserver --name motofacil-db --service-objective S0
# (Cria o banco de dados na nuvem)

---

# 5. Exibir a string de conexão (Ado.Net)
az sql db show-connection-string --server motofacilserver --name motofacil-db --client ado.net
# (Mostra a string de conexão para uso na aplicação)

---

# 6. Liberar acesso da Azure ao SQL
az sql server firewall-rule create --resource-group motofacil-rg --server motofacilserver --name AllowAzureServices --start-ip-address 0.0.0.0 --end-ip-address 0.0.0.0
# (Permite conexões vindas de serviços do Azure)

---

# 7. Liberar acesso do seu IP ao SQL
az sql server firewall-rule create --resource-group motofacil-rg --server motofacilserver --name AllowLocal --start-ip-address <SEU IP> --end-ip-address <SEU IP>
# (Substitua <SEU IP> pelo seu IP real. Permite conexões do seu computador ao banco)

---

# 8. Criar o plano de App Service
az appservice plan create --name motofacil-plan --resource-group motofacil-rg --location brazilSouth --sku B1
# (Cria o plano de hospedagem para o App Service)

---

# 9. Criar o App Service (.NET 8)
az webapp create --resource-group motofacil-rg --plan motofacil-plan --name motofacil-app --runtime "DOTNET:8"
# (Cria a aplicação web hospedada no Azure)

---

# 10. Configurar a string de conexão no App Service
az webapp config connection-string set --resource-group motofacil-rg --name motofacil-app --connection-string-type SQLAzure --settings DefaultConnection="Server=tcp:motofacilserver.database.windows.net,1433;Database=motofacil-db;User ID=motofaciladmin;Password=Motofacil#2025;Encrypt=true;TrustServerCertificate=false;Connection Timeout=30;"
# (Define a conexão do App com o banco de dados criado)

---

# 11. Compilar e preparar publicação da aplicação
dotnet publish -c Release -o ./publish
# (Compila o projeto e gera os arquivos para deploy)

---

# 12. Compactar arquivos publicados
Compress-Archive -Path ./publish/* -DestinationPath ./app.zip
# (Compacta os arquivos publicados em um ZIP para upload)

---

# 13. Fazer deploy do ZIP para o App Service
az webapp deployment source config-zip --resource-group motofacil-rg --name motofacil-app --src ./app.zip
# (Envia e publica a aplicação no Azure)

---

# 14. Abrir o Swagger da API (no navegador)
https://motofacil-app.azurewebsites.net/swagger
# (Acesse este link para testar a API publicada)