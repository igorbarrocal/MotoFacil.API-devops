# ===============================
# ?? Deploy MotoFacilAPI na Azure
# ===============================

# 1. Login no Azure
Write-Host "?? Fazendo login no Azure..."
az login

# 2. Variáveis do projeto (edite se quiser mudar nomes/região)
$resourceGroup="MotoFacilRG"
$location="brazilsouth"    # Região do Azure (São Paulo)
$appServicePlan="MotoFacilPlan"
$webAppName="motofacilapiigor"   # Precisa ser único no Azure!
$projectPath=".\MotoFacilAPI"    # Pasta do projeto .NET
$publishPath=".\publish"

# 3. Selecionar a subscription (se tiver mais de uma, ajuste aqui)
# az account set --subscription "NomeDaSuaSubscription"

# 4. Criar Resource Group
Write-Host "?? Criando Resource Group..."
az group create --name $resourceGroup --location $location

# 5. Criar App Service Plan (FREE - troca para B1/S1 se quiser mais performance)
Write-Host "?? Criando App Service Plan..."
az appservice plan create --name $appServicePlan --resource-group $resourceGroup --sku FREE

# 6. Criar Web App .NET 8
Write-Host "?? Criando Web App..."
az webapp create --resource-group $resourceGroup --plan $appServicePlan --name $webAppName --runtime "DOTNET:8"

# 7. Publicar API .NET 8
Write-Host "?? Publicando projeto..."
dotnet publish $projectPath -c Release -o $publishPath

# 8. Fazer deploy
Write-Host "?? Fazendo deploy para Azure..."
az webapp deploy --resource-group $resourceGroup --name $webAppName --src-path $publishPath

# 9. Mostrar URL final
$defaultHostName = az webapp show --resource-group $resourceGroup --name $webAppName --query defaultHostName -o tsv
Write-Host "? Deploy finalizado! Sua API está disponível em: https://$defaultHostName/swagger"